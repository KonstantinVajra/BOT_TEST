# Telegram Review Bot

Бот для сбора и сохранения отзывов из пересланных сообщений в Telegram.

## Функциональность

- Получение пересланных сообщений от администратора
- Автоматическое определение категории отзыва (отель, гид, ресторан, экскурсия)
- Сохранение текста, медиафайлов и метаданных отзыва
- Связывание медиафайлов с контекстом из соседних сообщений
- Сохранение данных в PostgreSQL

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd telegram-review-bot
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# Установка в режиме разработки
pip install -e ".[dev]"
```

3. Создайте файл .env на основе .env.example и заполните необходимые переменные:
```
BOT_TOKEN=your_telegram_bot_token
ADMIN_ID=your_telegram_admin_id
DATABASE_URL=postgresql://user:password@host:5432/dbname
```

4. Примените миграции базы данных:
```bash
alembic upgrade head
```

## Запуск

```bash
python main.py
```

## Использование

1. Добавьте бота в Telegram
2. Перешлите боту сообщения с отзывами (текст, фото, видео, голосовые сообщения)
3. Бот автоматически определит категорию отзыва и сохранит данные в базу

## Структура базы данных

- `authors`: информация об авторах отзывов
- `reviews`: тексты отзывов и их метаданные
- `media`: медиафайлы, привязанные к отзывам

## Тестирование

```bash
# Запуск тестов
pytest tests/

# Запуск тестов с подробным выводом
pytest -v tests/

# Запуск конкретного теста
pytest tests/test_bot.py::test_photo_without_caption_has_context_from_neighboring_text
```

## Разработка

При разработке новых функций следуйте подходу TDD:
1. Напишите тест, описывающий желаемое поведение
2. Запустите тест и убедитесь, что он падает
3. Реализуйте минимальный код для прохождения теста
4. Проведите рефакторинг при необходимости
5. Повторите для следующей функции

## Лицензия

MIT 